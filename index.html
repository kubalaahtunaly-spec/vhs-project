<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>VHS_EXPEDITION_ULTIMATE</title>
    <link href="https://fonts.googleapis.com/css2?family=VT323&display=swap" rel="stylesheet">
    <style>
        body, html {
            margin: 0; padding: 0; background: #000; color: #eee;
            font-family: 'VT323', monospace; overflow: hidden;
            user-select: none; -webkit-tap-highlight-color: transparent;
            touch-action: manipulation;
        }
        .noise, .scanlines { position: fixed; top: 0; left: 0; width: 100%; height: 100%; pointer-events: none; z-index: 50; }
        .noise { background: url('https://64.media.tumblr.com/tumblr_m4627fID931qfjj9zo1_500.gif'); opacity: 0.1; }
        .scanlines { background: linear-gradient(rgba(18, 16, 16, 0) 50%, rgba(0, 0, 0, 0.2) 50%); background-size: 100% 4px; }

        #loading-screen { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: #000; z-index: 1001; display: flex; justify-content: center; align-items: center; }
        #start-btn { display: none; padding: 15px 40px; background: transparent; border: 2px solid #8b0000; color: #8b0000; font-family: 'VT323'; font-size: 1.6rem; cursor: pointer; }

        .cinema-container { display: flex; flex-direction: column; justify-content: center; align-items: center; height: 100vh; }
        #frame-image { width: 100%; max-height: 50vh; display: none; object-fit: contain; }
        #intertitle { font-size: 1.3rem; text-align: center; max-width: 90%; padding: 20px; line-height: 1.3; }

        #punishment-overlay {
            display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0, 0, 0, 0.98); color: #8b0000; z-index: 10000;
            flex-direction: column; justify-content: center; align-items: center;
        }

        #glitch-screen { 
            display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; 
            background: #000; z-index: 1000; flex-direction: column; 
            justify-content: flex-start; align-items: center; 
            padding: 40px 20px; overflow-y: auto; box-sizing: border-box;
        }
        .shaman-text-style { color: #ccc; font-size: 1.2rem; width: 100%; max-width: 600px; line-height: 1.5; text-align: center; }
        
        .final-distortion { animation: distort 0.1s infinite; }
        @keyframes distort { 0% { transform: skew(0deg); } 50% { transform: skew(1.2deg); filter: contrast(1.5) brightness(1.2); } 100% { transform: skew(-0.8deg); } }
    </style>
</head>
<body onclick="handleInteraction()">

<div class="noise"></div>
<div class="scanlines"></div>

<div id="loading-screen">
    <button id="start-btn" onclick="initExperience(event)">ОТКРОЙТЕ ГЛАЗА</button>
</div>

<div id="punishment-overlay"><h1 style="letter-spacing: 8px;">ТИШЕ.</h1></div>

<div class="cinema-container" id="main-ui">
    <img id="frame-image" src="" alt="">
    <div id="intertitle">ВКЛЮЧИТЬ ПЛЕНКУ</div>
</div>

<div id="glitch-screen"></div>

<script>
    const script = [
        { text: "Сегодня погода хорошая.", img: "1.webp", sound: ["природа.mp3"] },
        { text: "Слышали, что недалеко есть озеро.", img: "2.webp", sound: ["природа.mp3"] },
        { text: "Самое то, чтоб отдохнуть.", img: "3.webp", sound: ["природа.mp3"] },
        { text: "Не понимаю, почему жители были против.", img: "3.webp", sound: ["природа.mp3"] },
        { text: "Можно ведь хоть на день забыть о практике?", img: "4.webp", sound: ["природа.mp3"] },
        { text: "Поздним вечером захотели найти могилу шамана. Для забавы.", img: "5.webp", sound: ["природа.mp3"] },
        { text: "Некоторые отговаривали. Некоторые ослушались.", sound: ["листья.mp3"], auto: 5000 },
        { text: "Найти шамана не составило труда.", img: "7.webp", auto: 6000, sound: ["листья.mp3"] },
        { text: "Не помню, что мы там делали,..", img: "8.webp", auto: 6000, sound: ["струя3.mp3"] },
        { text: "Наступила ночь. Было так холодно.", sound: ["ночь.mp3"], auto: 5500 },
        { text: "Даже внутри тесной палатки.", sound: ["ночь.mp3"], auto: 4500 },
        { text: "Становилось ветрено. Больше походило на бурю. ", sound: ["буря.mp3", "шаги.mp3", "бубен.mp3"], auto: 7000 },
        { text: "И вместе с этим кто-то начал ходить вокруг нас.", sound: ["буря.mp3", "шаги.mp3", "бубен.mp3"], auto: 6500 },
        { text: "Пытались угрозами напугать гостя.", sound: ["буря.mp3", "шаги.mp3", "бубен.mp3"], auto: 5000 },
        { text: "Но он не уходил.", sound: ["буря.mp3", "шаги.mp3", "бубен.mp3"], auto: 4000 },
        { text: "Вдруг резко велел мне и моему другу выйти из палатки.", sound: ["буря.mp3", "шаги.mp3", "бубен.mp3"], auto: 7000 },
        { text: "От страха наши друзья вытолкнули нас.", sound: ["замок.mp3"], auto: 5000 },
        { text: "Снаружи никого не оказалось.", img: "10.webp", sound: "stop", auto: 6000 },
        { text: "Никого и ничего.", auto: 4000 },
        { text: "Хотели вернуться, но внутри никто больше не ждал. Мы их больше не узнавали.", img: "11.webp", auto: 7000 },
        { text: "Мы так испугались, что оставили их в лесу.", auto: 6000 },
        { text: "Рассказали жителям, что произошло.", auto: 5500 },
        { text: "В итоге нас допросили,..", img: "13.webp", auto: 4500 },
        { text: "Нас обвинили.", img: "14.webp", auto: 4000 },
        { text: "Никто не объяснил, что произошло на самом деле.", img: "15.webp", auto: 6000 },
        { text: "Сказали, что в ту ночь точно не было бури.", img: "15.webp", auto: 6000 },
        { text: "Экспертиза выявила у жертв сердечную недостаточность,", img: "16.webp", auto: 7000 },
        { text: "Поэтому нас отпустили домой.", img: "17.webp", auto: 5000, sound: ["бубен.mp3"] },
        { text: "Думал, что всё теперь позади, но что-то...", img: "18.webp", auto: 5500, sound: ["бубен.mp3"] },
        { text: "Меня беспокоило.", auto: 4500, sound: ["бубен.mp3"] },
        { glitch: true }
    ];

    let current = -1;
    let isAuto = false;
    let activeAudios = {}; 
    let clickCount = 0;
    let lastClickTime = 0;

    window.onload = () => { document.getElementById('start-btn').style.display = "block"; };

    function initExperience(e) {
        e.stopPropagation();
        document.getElementById('loading-screen').style.display = "none";
        nextStep();
    }

    function handleInteraction() {
        const now = Date.now();
        if (now - lastClickTime < 350) clickCount++;
        else clickCount = 0;
        lastClickTime = now;
        if (clickCount > 4) { triggerPunishment(); clickCount = 0; return; }
        if (!isAuto && current >= 0) nextStep();
    }

    function triggerPunishment() {
        const overlay = document.getElementById('punishment-overlay');
        overlay.style.display = "flex";
        const isSilenceManual = (current >= 17 && current <= 26);
        if (!isSilenceManual) {
            let s = new Audio("бубен.mp3");
            s.volume = 0.5; s.play().catch(()=>{});
            setTimeout(() => { s.pause(); s.src = ""; }, 1100);
        }
        setTimeout(() => { overlay.style.display = "none"; }, 1200);
    }

    function playSounds(files) {
        if (files === "stop") {
            for (let f in activeAudios) { activeAudios[f].pause(); delete activeAudios[f]; }
            return;
        }
        const toPlay = Array.isArray(files) ? files : [files];
        for (let f in activeAudios) {
            if (!toPlay.includes(f)) { activeAudios[f].pause(); delete activeAudios[f]; }
        }
        toPlay.forEach(f => {
            if (!activeAudios[f]) {
                let a = new Audio(f);
                a.loop = (f !== "замок.mp3" && f !== "струя3.mp3" && f !== "бубен.mp3");
                a.volume = 0.3; a.play().catch(()=>{});
                activeAudios[f] = a;
            }
        });
    }

    function nextStep() {
        current++;
        if (current >= script.length) return;
        const step = script[current];
        if (step.glitch) { startGlitch(); return; }
        if (step.sound) playSounds(step.sound);
        
        const img = document.getElementById('frame-image');
        if (step.img) { img.src = step.img; img.style.display = "block"; } else { img.style.display = "none"; }
        document.getElementById('intertitle').innerText = step.text || "";
        
        if (step.auto) { 
            isAuto = true; 
            setTimeout(() => { if (isAuto) nextStep(); }, step.auto); 
        } else { isAuto = false; }
    }

    function startGlitch() {
        playSounds("stop");
        const screen = document.getElementById('glitch-screen');
        document.getElementById('main-ui').style.display = 'none';
        screen.style.display = "flex";
        screen.style.background = "#050000"; 
        
        const terminal = document.createElement('div');
        terminal.className = "shaman-text-style";
        terminal.style.textTransform = "uppercase";
        screen.appendChild(terminal);

        const lines = [
            "Ты выжил?", "Нет.", "Ты просто вышел наружу.",
            "Палатка была заперта снаружи.", "ТВОИМИ. РУКАМИ.",
            "Они кричали.", "А ты слушал.", "Я вас не отпускал.",
            "Я просто удлинил поводок.",
            "ТЕПЕРЬ ТЯНИ.", "ТЯНИ.", "ТЯНИ."
        ];

        let i = 0;
        function showLine() {
            if (i < lines.length) {
                let d = document.createElement('div');
                d.style.marginBottom = "20px";
                d.style.letterSpacing = "2px";
                
                // Прогрессия шрифта для ТЯНИ
                if (i === lines.length - 3) {
                    d.style.color = "#8b0000"; d.style.fontSize = "2.5rem"; d.style.fontWeight = "bold";
                } else if (i === lines.length - 2) {
                    d.style.color = "#ff0000"; d.style.fontSize = "4.5rem"; d.style.fontWeight = "900";
                    d.style.textShadow = "0 0 15px rgba(255,0,0,0.6)";
                } else if (i === lines.length - 1) {
                    d.style.color = "#ff0000"; d.style.fontSize = "8rem"; d.style.fontWeight = "900";
                    d.style.textShadow = "0 0 30px rgba(255,0,0,1)";
                    screen.classList.add('final-distortion');
                }

                terminal.appendChild(d);
                let charI = 0;
                let text = lines[i];
                let speed = i >= lines.length - 3 ? 150 : 60;

                let typer = setInterval(() => {
                    if (charI < text.length) {
                        d.innerText += text[charI];
                        charI++;
                        let s = new Audio("бубен.mp3");
                        s.playbackRate = i >= lines.length - 3 ? 0.6 : 2;
                        s.volume = i >= lines.length - 3 ? 0.5 : 0.1;
                        s.play().catch(()=>{});
                        screen.scrollTop = screen.scrollHeight;
                    } else {
                        clearInterval(typer);
                        i++;
                        setTimeout(showLine, i >= lines.length - 3 ? 1000 : 1200);
                    }
                }, speed);
            } else {
                setTimeout(() => {
                    screen.style.background = "#fff";
                    let finalScreamer = new Audio("бубен.mp3");
                    finalScreamer.volume = 1; finalScreamer.play().catch(()=>{});
                    setTimeout(() => window.location.reload(), 400);
                }, 3000);
            }
        }
        showLine();
    }
</script>
</body>
</html>
